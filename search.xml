<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>配合 Valine 评论系统使用的 Valine-Admin 及显示个性头像</title>
      <link href="/Valine-Admin-Gravatar/"/>
      <url>/Valine-Admin-Gravatar/</url>
      
        <content type="html"><![CDATA[<p><a name="Valine"></a></p><h1 id="Valine"><a href="#Valine" class="headerlink" title="Valine"></a>Valine</h1><p>一款快速、简洁且高效的无后端评论系统。</p><p>Valine 诞生于2017年8月7日，是一款基于<a href="https://www.leancloud.cn/" target="_blank" rel="noopener">LeanCloud</a>的快速、简洁且高效的无后端评论系统。</p><p>理论上支持但不限于静态博客，目前已有Hexo、Jekyll、Typecho、Hugo、Ghost 等博客程序在使用 <a href="https://valine.js.org/" target="_blank" rel="noopener">Valine</a>。</p><p><a name="c666ad11"></a></p><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>快速</li><li>安全</li><li>Emoji 😉</li><li>无后端实现</li><li>MarkDown 全语法支持</li><li>轻量易用(~15kb gzipped)</li><li>文章阅读量统计   v1.2.0+</li></ul><p><a name="c9c2e389"></a></p><h2 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h2><ol><li>注册<a href="https://www.leancloud.cn/" target="_blank" rel="noopener">LeanCloud</a></li><li>创建<code>Valine</code>应用，名称任意，例如<code>Valine</code></li><li>进入对应的应用，点击<code>设置 -&gt; 应用 Keys</code>，获取<code>AppID</code>和<code>AppKey</code></li><li>以<code>Hexo</code>主题配置文件为例，填入对应的地方，后面考虑加入到<code>Django</code></li></ol><pre><code>valine:  enable: true  appId: AppID  appKey: AppKey  notify: false  verify: false  visitor: true  avatar: &#39;mp&#39; # Gravatar style : mp/identicon/monsterid/wavatar/retro/hide  pageSize: 10  placeholder: &#39;just go go&#39; # Comment Box placeholder</code></pre><p><a name="c8aa3ee9"></a></p><h2 id="Valine-配置"><a href="#Valine-配置" class="headerlink" title="Valine 配置"></a>Valine 配置</h2><ol><li>查看评论<br /><br>点击 <code>存储 -&gt; 结构化数据</code>，选择<code>创建Class</code>，名称<code>Comment</code>，其他保持默认，以后就可在此Class内查看</li><li>文章阅读量统计<br /><br>点击 <code>存储 -&gt; 结构化数据</code>，选择<code>创建Class</code>，名称<code>Counter</code>，其他保持默认，以后就可在此Class内查看</li></ol><blockquote><p>注：文章阅读量统计有时会和博客内的统计软件不兼容</p></blockquote><p><a name="Valine-Admin"></a></p><h1 id="Valine-Admin"><a href="#Valine-Admin" class="headerlink" title="Valine-Admin"></a>Valine-Admin</h1><p><a href="https://github.com/hongweifuture/Valine-Admin" target="_blank" rel="noopener">Github 项目地址，具体教程以 最新版 为准</a></p><p><a name="e05dce83"></a></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Valine Admin 项目是一个对 <a href="https://valine.js.org" target="_blank" rel="noopener">Valine</a> 评论系统的拓展应用，可增强 Valine 的邮件通知功能。基于 Leancloud 的云引擎与云函数，主要实现评论邮件通知、评论管理、自定义邮件通知模板等功能，而且还可以提供邮件 <code>通知站长</code> 和 <code>@ 通知</code> 的功能。</p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/高级配置.md#邮件通知展示" target="_blank" rel="noopener">点击查看演示</a></p><p><a name="a9f94dcd"></a></p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><ol><li>需要确保 Valine 的基础功能是正常的，参考 <a href="https://valine.js.org" target="_blank" rel="noopener">Valine Docs</a>。</li><li>进入 <a href="https://leancloud.cn/dashboard/applist.html#/apps" target="_blank" rel="noopener">Leancloud</a> 对应的 Valine 应用中。</li><li>点击 <code>云引擎 -&gt; 设置</code> 填写代码库：<code>https://github.com/hongweifuture/Valine-Admin</code>，保存<br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583200-efdde808-5f3c-4ced-8979-80772b4ba08b.jpeg#align=left&display=inline&height=434&originHeight=434&originWidth=1137&size=0&status=done&style=none&width=1137" alt=""></li><li>设置<code>自定义环境变量</code>，需要设置云引擎的环境变量以提供必要的信息，变量参数参考下面的<code>配置项</code><br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583224-454cf22f-9f06-4a71-8e9c-4db497961fcb.jpeg#align=left&display=inline&height=500&originHeight=500&originWidth=1056&size=0&status=done&style=none&width=1056" alt=""><br /></li></ol><p><strong>配置项</strong><br>| 变量 | 示例 | 说明 |<br>| — | — | :— |<br>| SITE_NAME | HONGWEI’S Blog | [必填] 网站名称 |<br>| SITE_URL | <a href="https://www.zhwei.cn">https://www.zhwei.cn</a> | [必填] 网站地址，<strong>最后不要加 <code>/</code></strong> |<br>| SMTP_SERVICE | QQ | [必填] 邮件服务提供商，支持 QQ、163、126、Gmail 以及 <a href="https://nodemailer.com/smtp/well-known/#supported-services" target="_blank" rel="noopener">更多</a>。 — <em>如这里没有你使用的邮件提供商，请查看<a href="/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8">自定义邮件服务器</a></em> |<br>| SMTP_USER | <a href="mailto:xxxx@qq.com">xxxx@qq.com</a> | [必填] SMTP登录用户，一般为邮箱地址 |<br>| SMTP_PASS | xxxx | [必填] SMTP登录密码，一般为授权码，而不是邮箱的登陆密码，请自行查询对应邮件服务商的获取方式 |<br>| SENDER_NAME | HONGWEI’S Blog Valine 评论提醒 | [可选] 发件人 |<br>| ADMIN_URL | <a href="https://xxx.leanapp.cn/" target="_blank" rel="noopener">https://xxx.leanapp.cn/</a> | [建议] Web主机二级域名，用于自动唤醒 |<br>| TO_EMAIL | <a href="mailto:xxxxx@gmail.com">xxxxx@gmail.com</a> | [可选] 指定站长收信邮箱，默认值为<code>SITE_USER</code>。用于 SMTP 发件人与站长收件人不一致的情况下使用。 |<br>| TEMPLATE_NAME | rainbow | [可选] 通知邮件的模板（default和rainbow），参考高级功能 |</p><ol start="5"><li>点击 <code>云引擎 -&gt; 部署</code>，选择<code>Git源码部署</code>，分支或版本号输入<code>master</code>，下载最新依赖（可选），部署<br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583264-0a614019-37bd-4280-a0bc-b3ee40913972.jpeg#align=left&display=inline&height=430&originHeight=430&originWidth=1367&size=0&status=done&style=none&width=1367" alt=""><br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583247-6032f750-c7b1-4a8c-87d6-b73d16b0aa57.jpeg#align=left&display=inline&height=558&originHeight=558&originWidth=1229&size=0&status=done&style=none&width=1229" alt=""></li></ol><p><a name="877a58ea"></a></p><h2 id="后台管理"><a href="#后台管理" class="headerlink" title="后台管理"></a>后台管理</h2><ol><li>点击 <code>云引擎 -&gt; 设置</code>，在<code>Web主机域名</code>位置点击<code>申请</code>，获取二级域名，现在的二级域名不支持自定义，如果想好记请参考高级功能<br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583250-df039847-2069-4309-8f67-66fdd4930b4b.jpeg#align=left&display=inline&height=233&originHeight=233&originWidth=1052&size=0&status=done&style=none&width=1052" alt=""></li><li>设置后台管理登录信息，点击 <code>存储 -&gt; 结构化数据</code>，选择<code>_User -&gt; 添加行</code>，只需要填写<code>password</code>、<code>username</code>、<code>email</code>这三个字段即可, 使用 email 作为账号登陆、password 作为账号密码、username 任意即可。（为了安全考虑，此 email 必须为配置中的 SMTP_USER 或 TO_EMAIL， 否则不允许登录）<br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583265-8cf805c9-3207-4ac9-a110-d79ba4aa4f80.jpeg#align=left&display=inline&height=429&originHeight=429&originWidth=1239&size=0&status=done&style=none&width=1239" alt=""></li><li>此后，可以通过<code>https://二级域名.leanapp.cn/</code>管理评论</li></ol><p><a name="a1bd9760"></a></p><h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><p>免费版的 LeanCloud 容器，是有强制性休眠策略的，不能 24 小时运行：</p><ul><li>每天必须休眠 6 个小时</li><li>30 分钟内没有外部请求，则休眠</li><li>休眠后如果有新的外部请求实例则马上启动（但激活时此次发送邮件会失败）。</li></ul><p>分析了一下上方的策略，如果不想付费的话，最佳使用方案就设置定时器，目前基于 LeanCloud 自带定时器实现了两种云函数定时任务：</p><ul><li>自动唤醒，定时访问Web APP二级域名防止云引擎休眠（推荐）</li><li>定时检查，每天定时检查24小时内漏发的邮件通知</li></ul><p><strong>配置</strong></p><ol><li>首先需要添加环境变量，点击 <code>云引擎 -&gt; 设置</code>，配置<code>自定义环境变量</code>，变量名<code>ADMIN_URL</code>，变量值<code>Web 主机域名，即二级域名地址</code>，添加后重启容器环境变量才会生效</li><li>配置定时任务，击 <code>云引擎 -&gt; 定时任务</code></li></ol><ul><li>配置自动唤醒（推荐），创建定时任务，名称任意，生产环境选择<code>self-wake</code>云函数，Cron表达式填入<code>0 */20 7-23 * * ?</code>，表示每天 7 - 23 点每 20 分钟访问一次，这样可以保持每天的绝大多数时间邮件服务是正常的。</li><li>配置定时检查，创建定时任务，名称任意，生产环境选择<code>resend-mails</code>云函数，Cron表达式填入<code>0 0 8 * * ?</code>，表示每天早8点检查过去24小时内漏发的通知邮件并补发<br /><br><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/373062/1583161583276-c803e0be-bf16-4d6d-9b1f-8e2bd008c6d4.jpeg#align=left&display=inline&height=592&originHeight=592&originWidth=1235&size=0&status=done&style=none&width=1235" alt=""></li></ul><p><a name="1f318234"></a></p><h2 id="高级配置"><a href="#高级配置" class="headerlink" title="高级配置"></a>高级配置</h2><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%82%AE%E4%BB%B6%E6%A8%A1%E6%9D%BF" target="_blank" rel="noopener">自定义邮件模板</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%94%B6%E4%BB%B6%E9%82%AE%E7%AE%B1" target="_blank" rel="noopener">自定义收件邮箱</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">自定义邮件服务器</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#web-%E8%AF%84%E8%AE%BA%E7%AE%A1%E7%90%86" target="_blank" rel="noopener">Web 评论管理</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E5%A5%BD%E8%AE%B0%E7%9A%84%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D" target="_blank" rel="noopener">好记的二级域名</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#leancloud-%E4%BC%91%E7%9C%A0%E7%AD%96%E7%95%A5" target="_blank" rel="noopener">Leancloud 休眠策略(必看)</a></p><p><a href="https://github.com/hongweifuture/Valine-Admin/blob/master/%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE.md#%E5%BC%80%E5%8F%91" target="_blank" rel="noopener">开发指南</a></p><p><a name="e9510be1"></a></p><h2 id="显示个性头像"><a href="#显示个性头像" class="headerlink" title="显示个性头像"></a>显示个性头像</h2><p>Valine 目前使用的是<a href="http://cn.gravatar.com/" target="_blank" rel="noopener">Gravatar</a> 作为评论列表头像。</p><p>请自行登录或注册<a href="http://cn.gravatar.com/" target="_blank" rel="noopener">Gravatar</a>，然后修改自己的头像。</p><p>评论的时候，留下在<a href="http://cn.gravatar.com/" target="_blank" rel="noopener">Gravatar</a>注册时所使用的邮箱即可。</p><p>感谢<code>gravatar.cat.net</code>提供的镜像服务。</p><blockquote><p>如果你修改了头像后发现没有更新，请不要慌张，因为<code>gravatar.cat.net</code> 有七天的缓存期，安静的等待吧~</p></blockquote><p>目前<code>非自定义头像</code>有以下7种<code>默认值</code>可选:</p><table><thead><tr><th align="center">参数值</th><th align="center">表现形式</th><th>备注</th></tr></thead><tbody><tr><td align="center">空字符串<code>&#39;&#39;</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207232029388.jpg#alt=Gravatar%E5%AE%98%E6%96%B9%E5%9B%BE%E5%BD%A2" alt=""></td><td>Gravatar官方图形</td></tr><tr><td align="center"><code>mp</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231815493.png#alt=%E7%A5%9E%E7%A7%98%E4%BA%BA%28%E4%B8%80%E4%B8%AA%E7%81%B0%E7%99%BD%E5%A4%B4%E5%83%8F%29" alt=""></td><td>神秘人(一个灰白头像)</td></tr><tr><td align="center"><code>identicon</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231835995.png#alt=%E6%8A%BD%E8%B1%A1%E5%87%A0%E4%BD%95%E5%9B%BE%E5%BD%A2" alt=""></td><td>抽象几何图形</td></tr><tr><td align="center"><code>monsterid</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231850268.png#alt=%E5%B0%8F%E6%80%AA%E7%89%A9" alt=""></td><td>小怪物</td></tr><tr><td align="center"><code>wavatar</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231902977.png#alt=%E7%94%A8%E4%B8%8D%E5%90%8C%E9%9D%A2%E5%AD%94%E5%92%8C%E8%83%8C%E6%99%AF%E7%BB%84%E5%90%88%E7%94%9F%E6%88%90%E7%9A%84%E5%A4%B4%E5%83%8F" alt=""></td><td>用不同面孔和背景组合生成的头像</td></tr><tr><td align="center"><code>retro</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231915298.png#alt=%E5%85%AB%E4%BD%8D%E5%83%8F%E7%B4%A0%E5%A4%8D%E5%8F%A4%E5%A4%B4%E5%83%8F" alt=""></td><td>八位像素复古头像</td></tr><tr><td align="center"><code>robohash</code></td><td align="center"><img src="https://img-blog.csdnimg.cn/20200207231932699.png#alt=%E4%B8%80%E7%A7%8D%E5%85%B7%E6%9C%89%E4%B8%8D%E5%90%8C%E9%A2%9C%E8%89%B2%E3%80%81%E9%9D%A2%E9%83%A8%E7%AD%89%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA" alt=""></td><td>一种具有不同颜色、面部等的机器人</td></tr><tr><td align="center"><code>hide</code></td><td align="center"></td><td>不显示头像</td></tr></tbody></table><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Valine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token operator">...</span>    avatar<span class="token punctuation">:</span><span class="token string">''</span> <span class="token comment" spellcheck="true">// (''/mp/identicon/monsterid/wavatar/robohash/retro/hide)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><hr><p><strong>Gravatar是什么？</strong>           ——下面内容摘抄自<a href="https://www.iplaysoft.com/gravatar.html" target="_blank" rel="noopener">异次元软件世界</a></p><p><code>Gravatar</code>，它的全称叫做“Globally Recognized Avatar”，翻译过来叫做全球通用头像。</p><p>Gravatar 的概念首先是在国外的独立 <a href="https://wordpress.com/" target="_blank" rel="noopener">WordPress</a> 博客中兴起的，当你到任何一个支持Gravatar的网站留言时，这个网站都就会根据你所提供的 Email 地址为你显示出匹配的头像。当然，这个头像，是需要你事先到 Gravatar 的网站注册并上传的，否则，在这个网站上，就只会显示成一个默认的头像。</p><p>这个Web2.0时代的产物，当时好多网站均已支持Gravatar服务了，你可以通过你的个性头像打造起你的个人品牌了！并且这个 Gravatar 没有什么约束，想换头像换马甲？很简单，改改留言的名字和email地址就可以了。另外注册与使用 Gravatar 均是完全免费的，唯一的门槛是，国内可能无法正常访问。</p><hr><p>大致使用流程：</p><ol><li>注册：进入<a href="https://cn.gravatar.com/" target="_blank" rel="noopener">Gravatar网站</a>，点击页面的Sign Up进行注册。</li><li>验证：进入你的邮箱，从<code>Gravatar</code>发出的信件中拷贝那段链接地址，在浏览器输入。</li><li>设置昵称、密码。</li><li>选择上传图片：一般都是从电脑中上传（My computer’s hard drive）。</li><li>剪裁大小</li><li>评级：你的头像要被分级的，因为可能会有朋友喜欢用比较曝露的头像，会影响小朋友身心健康的说。如果你的图片不是特别那个的话，一般不用选择Sex或暴力之类的，直接选择G（通用型），这样基本任何网站都能显示这个等级的图片。异次元比较邪恶，暂时允许显示R级以下的头像…</li><li>等待审核：可能需要站方短暂审核一下，一般选择了G，而你的图片没什么特别的，很快就通过。一般遇上慢的情况也就10分钟左右。</li></ol><p>完成了以上步骤，今后在支持<code>Gravatar</code>的网站留言都会显示你帅帅的头像了。暂时来说，大部分支持Gravatar的网站均是使用 WordPress 程序的博客，但其实任何其他网站程序，如果加入了Gravatar的代码，也是可以支持Gravatar的。估计这个应用在日后会渐渐普及起来吧，起码用户不需要每到一个网站去就搞一下头像……</p><p><strong>Valine的个性头像就是来自<a href="https://cn.gravatar.com/" target="_blank" rel="noopener">Gravatar网站</a></strong></p>]]></content>
      
      
      <categories>
          
          <category> 技术积累 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ValineAdmin- </tag>
            
            <tag> Valine-Admin </tag>
            
            <tag> Leancloud </tag>
            
            <tag> 评论系统 </tag>
            
            <tag> Gravatar </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
